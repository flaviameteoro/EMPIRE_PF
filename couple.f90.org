program couple
!use mpi
implicit none
include 'mpif.h'
     integer dummycolour,myRank,nProc,mpi_err
     integer MY_MPI_COMMUNICATOR,mype_id,dummype_id
     integer DUMMY_MPI_COMMUNICATOR,couple_colour
     integer COUPLE_MPI_COMMUNICATOR,couple_mype_id,couple_root

     dummycolour=10000

     call MPI_Init (mpi_err)
        CALL MPi_COMM_RANK(MPI_COMM_WORLD,mype_id,mpi_err)
        CALL MPi_COMM_SPLIT(MPI_COMM_WORLD,dummycolour, &
                           mype_id,DUMMY_MPI_COMMUNICATOR,mpi_err)


     call MPI_Comm_Rank (DUMMY_MPI_COMMUNICATOR, myRank, mpi_err)
     call MPI_Comm_Size (DUMMY_MPI_COMMUNICATOR, nProc, mpi_err)

couple_colour=9999

        CALL MPi_COMM_SPLIT(MPI_COMM_WORLD,couple_colour, &
                           mype_id,COUPLE_MPI_COMMUNICATOR,mpi_err)

     call MPI_Comm_Rank (COUPLE_MPI_COMMUNICATOR, myRank, mpi_err)
     call MPI_Comm_Size (COUPLE_MPI_COMMUNICATOR, nProc, mpi_err)

         call MPi_allreduce(myrank,couple_root,1,MPi_INT8,MPi_MAX,0,
     $        COUPLE_MPI_COMMUNICATOR)

     write(6,*)'chello',mype_id,myrank,nproc,couple_root
     call MPI_Finalize(mpi_err)

end program

